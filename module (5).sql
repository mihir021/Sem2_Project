-- phpMyAdmin SQL Dump
-- version 5.2.1
-- https://www.phpmyadmin.net/
--
-- Host: 127.0.0.1
-- Generation Time: Aug 23, 2025 at 09:20 AM
-- Server version: 10.4.32-MariaDB
-- PHP Version: 8.0.30

SET SQL_MODE = "NO_AUTO_VALUE_ON_ZERO";
START TRANSACTION;
SET time_zone = "+00:00";


/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */;
/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */;
/*!40101 SET NAMES utf8mb4 */;

--
-- Database: `module`
--

DELIMITER $$
--
-- Procedures
--
CREATE DEFINER=`root`@`localhost` PROCEDURE `log_operation` (IN `tbl` VARCHAR(50), IN `op` VARCHAR(20), IN `rowid` VARCHAR(50))   BEGIN
    INSERT INTO operation_log(table_name, operation_type, affected_row_id)
    VALUES (tbl, op, rowid);
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `updateFaculty` (IN `facId_in` INT, IN `choice_in` VARCHAR(50), IN `updatedV_in` VARCHAR(50), IN `id_in` INT)   BEGIN
    CASE UPPER(choice_in)
        WHEN '1' THEN
            UPDATE faculty SET FacultyContactNo = updatedV_in WHERE facultyId = facId_in;
        WHEN '2' THEN
            UPDATE faculty SET facultyEmail = updatedV_in WHERE facultyId = facId_in;
        WHEN '3' THEN
            UPDATE faculty SET facultyAddress = updatedV_in WHERE facultyId = facId_in;
        WHEN '4' THEN
            UPDATE faculty SET specialization = updatedV_in WHERE facultyId = facId_in;
        WHEN '5' THEN
            UPDATE faculty SET deptID = id_in WHERE facultyId = facId_in;
        WHEN '6' THEN
            UPDATE faculty SET subjectID = id_in WHERE facultyId = facId_in;
        WHEN '7' THEN
            UPDATE faculty SET facultyName = updatedV_in WHERE facultyId = facId_in;
    END CASE;
END$$

CREATE DEFINER=`root`@`localhost` PROCEDURE `updateStudent` (IN `enroll_in` BIGINT, IN `choice_in` VARCHAR(50), IN `updatedV_in` VARCHAR(50), IN `id_in` INT)   BEGIN
    CASE UPPER(choice_in)
        WHEN '1' THEN
            UPDATE student SET studentName = updatedV_in WHERE enrollmentNo = enroll_in;
        WHEN '2' THEN
            UPDATE student SET studentPassword = updatedV_in WHERE enrollmentNo = enroll_in;
        WHEN '3' THEN
            UPDATE student SET studentContactNo = updatedV_in WHERE enrollmentNo = enroll_in;
        WHEN '4' THEN
            UPDATE student SET studentAddress = updatedV_in WHERE enrollmentNo = enroll_in;
        WHEN '5' THEN
            UPDATE student SET studentEmail = updatedV_in WHERE enrollmentNo = enroll_in;
        WHEN '6' THEN
            UPDATE student SET deptID = id_in WHERE enrollmentNo = enroll_in;
        WHEN '7' THEN
            UPDATE student SET courseID = id_in WHERE enrollmentNo = enroll_in;
    END CASE;
END$$

DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `attendance`
--

CREATE TABLE `attendance` (
  `enrollmentNo` bigint(20) NOT NULL,
  `subjectID` int(11) NOT NULL,
  `date` date NOT NULL,
  `status` varchar(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `attendance`
--

INSERT INTO `attendance` (`enrollmentNo`, `subjectID`, `date`, `status`) VALUES
(24002170210035, 1, '2025-08-24', 'A'),
(24002170210098, 1, '2025-08-23', 'P');

-- --------------------------------------------------------

--
-- Table structure for table `course`
--

CREATE TABLE `course` (
  `courseID` int(11) NOT NULL,
  `courseName` varchar(50) NOT NULL,
  `deptID` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `course`
--

INSERT INTO `course` (`courseID`, `courseName`, `deptID`) VALUES
(1, 'IT', 2),
(2, 'CE', 1),
(3, 'AIDS', 2);

-- --------------------------------------------------------

--
-- Table structure for table `department`
--

CREATE TABLE `department` (
  `deptID` int(11) NOT NULL,
  `deptName` varchar(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `department`
--

INSERT INTO `department` (`deptID`, `deptName`) VALUES
(1, 'FY1'),
(2, 'FY2');

-- --------------------------------------------------------

--
-- Table structure for table `event`
--

CREATE TABLE `event` (
  `eventNo` int(11) NOT NULL,
  `eventName` varchar(30) NOT NULL,
  `date` date NOT NULL,
  `aboutEvent` longtext NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Triggers `event`
--
DELIMITER $$
CREATE TRIGGER `trg_event_after_insert_notify_all` AFTER INSERT ON `event` FOR EACH ROW BEGIN
  INSERT INTO notificationstudent (enrollmentNo, notificationContent)
  SELECT s.enrollmentNo,
         CONCAT('New event: ', NEW.eventName, ' on ',NEW.date)
  FROM student s;
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `exam`
--

CREATE TABLE `exam` (
  `subjectID` int(11) NOT NULL,
  `subjectName` varchar(30) NOT NULL,
  `examDate` date NOT NULL,
  `examTime` time NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `exam`
--

INSERT INTO `exam` (`subjectID`, `subjectName`, `examDate`, `examTime`) VALUES
(1, 'Java', '2025-08-13', '12:30:00'),
(2, 'Maths', '2025-08-23', '11:30:00'),
(1, 'Java', '2025-11-23', '12:12:00');

--
-- Triggers `exam`
--
DELIMITER $$
CREATE TRIGGER `trg_exam_after_insert_notify_all` AFTER INSERT ON `exam` FOR EACH ROW BEGIN
  INSERT INTO notificationstudent (enrollmentNo, notificationContent)
  SELECT s.enrollmentNo,
         CONCAT('Exam scheduled: ', NEW.subjectName, ' on ', NEW.examDate, ' at ', NEW.examTime)
  FROM student s;
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `faculty`
--

CREATE TABLE `faculty` (
  `facultyID` int(11) NOT NULL,
  `facultyName` varchar(50) NOT NULL,
  `facultyPassword` varchar(50) NOT NULL,
  `facultyContactNo` varchar(10) NOT NULL,
  `facultyEmail` varchar(50) NOT NULL,
  `facultyAddress` varchar(50) NOT NULL,
  `specialization` varchar(50) NOT NULL,
  `deptID` int(11) NOT NULL,
  `subjectID` varchar(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `faculty`
--

INSERT INTO `faculty` (`facultyID`, `facultyName`, `facultyPassword`, `facultyContactNo`, `facultyEmail`, `facultyAddress`, `specialization`, `deptID`, `subjectID`) VALUES
(1, 'NRS', 'NRS@123', '8989898989', 'NRS@123', 'ahemdabad', 'Java', 2, '1'),
(2, 'CVM', 'CVM@123', '9789097888', 'CVM@ljku.edu.in', 'rajkot', 'Java', 2, '1'),
(3, 'ABC', 'ABC@123', '8978675645', 'ABC@ljku.edu.in', 'ABC12', 'Maths', 1, '2');

--
-- Triggers `faculty`
--
DELIMITER $$
CREATE TRIGGER `faculty_after_delete` AFTER DELETE ON `faculty` FOR EACH ROW BEGIN
    CALL log_operation('faculty', 'DELETE', OLD.facultyId);
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `faculty_after_insert` AFTER INSERT ON `faculty` FOR EACH ROW BEGIN
    CALL log_operation('faculty', 'INSERT', NEW.facultyId);
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `faculty_after_update` AFTER UPDATE ON `faculty` FOR EACH ROW BEGIN
    CALL log_operation('faculty', 'UPDATE', NEW.facultyId);
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `facultyfiles`
--

CREATE TABLE `facultyfiles` (
  `FacultyID` int(11) NOT NULL,
  `FileName` varchar(30) NOT NULL,
  `File` longblob NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `facultyfiles`
--

INSERT INTO `facultyfiles` (`FacultyID`, `FileName`, `File`) VALUES
(1, '1.pdf', 0x255044462d312e340a25e2e3cfd30a322030206f626a0a3c3c2f4c656e677468203137302f46696c7465722f466c6174654465636f64653e3e73747265616d0a789c7dcfc10a82401006e0fb3ec51ceb20ed2a88ed294b852e52b92f30ba1b25ae96bb12bd7d5a08054bcc65e0ff18feb993ad204108110d414842c163d1b4ac3206cc0771268b0caba1b14f4894c56b6396a21e19fdd1b3d9271c9813e4a81587fc5438d3031af3e87af9161be6074eb5eb5a8b95e510ade771ba548f3dff9f8aa5ec95311cf0a2b4c412a59325ea86bdd5aab5def49aef44c550d6aafa08fa2552418ee4054b6957f80a656e6473747265616d0a656e646f626a0a342030206f626a0a3c3c2f547970652f506167652f4d65646961426f785b30203020353935203834325d2f5265736f75726365733c3c2f466f6e743c3c2f46312031203020523e3e3e3e2f436f6e74656e74732032203020522f506172656e742033203020523e3e0a656e646f626a0a312030206f626a0a3c3c2f547970652f466f6e742f537562747970652f54797065312f42617365466f6e742f48656c7665746963612f456e636f64696e672f57696e416e7369456e636f64696e673e3e0a656e646f626a0a332030206f626a0a3c3c2f547970652f50616765732f436f756e7420312f4b6964735b34203020525d3e3e0a656e646f626a0a352030206f626a0a3c3c2f547970652f436174616c6f672f50616765732033203020523e3e0a656e646f626a0a362030206f626a0a3c3c2f50726f6475636572286954657874ae20352e352e31332e3420a9323030302d323032342069546578742047726f7570204e56205c284147504c2d76657273696f6e5c29292f4372656174696f6e4461746528443a32303235303832333131313333372b303527333027292f4d6f644461746528443a32303235303832333131313333372b303527333027293e3e0a656e646f626a0a787265660a3020370a303030303030303030302036353533352066200a30303030303030333634203030303030206e200a30303030303030303135203030303030206e200a30303030303030343532203030303030206e200a30303030303030323532203030303030206e200a30303030303030353033203030303030206e200a30303030303030353438203030303030206e200a747261696c65720a3c3c2f53697a6520372f526f6f742035203020522f496e666f2036203020522f4944205b3c36333335613166616439383538396566316331613138356434356634353532663e3c36333335613166616439383538396566316331613138356434356634353532663e5d3e3e0a2569546578742d352e352e31332e340a7374617274787265660a3730380a2525454f460a),
(2, '2.pdf', 0x255044462d312e340a25e2e3cfd30a322030206f626a0a3c3c2f4c656e677468203138312f46696c7465722f466c6174654465636f64653e3e73747265616d0a789c6dcfcb0ac2301005d07dbe6296ba684d5aa8b12bb50f70a12806f7b189d0b7e681f8f7b61641219b61e01e863b0fb465288c80e2089840183c42c76591132001b01b9ae5bcb08d79412a0d2f1b3d67d5c0f09ffe9a5d1a43e00407deca1892cbde991eb9d6cf5e898f58932074aaa4ef0c2f4c0cab255de16150ea74593bf49c4e35556d7d29ac5f764eba114249ad6350bcaa7be334a9bc73655ad9196ffc8f38d1d95e2b594c02ff888ca1137a03927d5a5a0a656e6473747265616d0a656e646f626a0a342030206f626a0a3c3c2f547970652f506167652f4d65646961426f785b30203020353935203834325d2f5265736f75726365733c3c2f466f6e743c3c2f46312031203020523e3e3e3e2f436f6e74656e74732032203020522f506172656e742033203020523e3e0a656e646f626a0a312030206f626a0a3c3c2f547970652f466f6e742f537562747970652f54797065312f42617365466f6e742f48656c7665746963612f456e636f64696e672f57696e416e7369456e636f64696e673e3e0a656e646f626a0a332030206f626a0a3c3c2f547970652f50616765732f436f756e7420312f4b6964735b34203020525d3e3e0a656e646f626a0a352030206f626a0a3c3c2f547970652f436174616c6f672f50616765732033203020523e3e0a656e646f626a0a362030206f626a0a3c3c2f50726f6475636572286954657874ae20352e352e31332e3420a9323030302d323032342069546578742047726f7570204e56205c284147504c2d76657273696f6e5c29292f4372656174696f6e4461746528443a32303235303832333131313433362b303527333027292f4d6f644461746528443a32303235303832333131313433362b303527333027293e3e0a656e646f626a0a787265660a3020370a303030303030303030302036353533352066200a30303030303030333735203030303030206e200a30303030303030303135203030303030206e200a30303030303030343633203030303030206e200a30303030303030323633203030303030206e200a30303030303030353134203030303030206e200a30303030303030353539203030303030206e200a747261696c65720a3c3c2f53697a6520372f526f6f742035203020522f496e666f2036203020522f4944205b3c64343561336139336566396637383137626335356466366332616164636131313e3c64343561336139336566396637383137626335356466366332616164636131313e5d3e3e0a2569546578742d352e352e31332e340a7374617274787265660a3731390a2525454f460a),
(3, '3.pdf', 0x255044462d312e340a25e2e3cfd30a322030206f626a0a3c3c2f4c656e677468203137392f46696c7465722f466c6174654465636f64653e3e73747265616d0a789c6dcfc90ac2301405d07dbee22d75d1dab436ad5dd911dc88627e2036115a3b689320febd1d1014b27b700f97fb9e28a1c823103a0428470e58389c8e4d8101bb406f6855b05237ea0d9950ac6ae49ad62373fef4d71cb2083c2338b256441027a9313d31295ffdc067b1c7aeb923ed3bc54a1541b80b4212f864eb1b5dde8e3b97aaa6be6b5b706d579d91c69c0f42ca1963d74832f160836a45a7ace93d6c44177dad45b908e747e4149dd107846f58910a656e6473747265616d0a656e646f626a0a342030206f626a0a3c3c2f547970652f506167652f4d65646961426f785b30203020353935203834325d2f5265736f75726365733c3c2f466f6e743c3c2f46312031203020523e3e3e3e2f436f6e74656e74732032203020522f506172656e742033203020523e3e0a656e646f626a0a312030206f626a0a3c3c2f547970652f466f6e742f537562747970652f54797065312f42617365466f6e742f48656c7665746963612f456e636f64696e672f57696e416e7369456e636f64696e673e3e0a656e646f626a0a332030206f626a0a3c3c2f547970652f50616765732f436f756e7420312f4b6964735b34203020525d3e3e0a656e646f626a0a352030206f626a0a3c3c2f547970652f436174616c6f672f50616765732033203020523e3e0a656e646f626a0a362030206f626a0a3c3c2f50726f6475636572286954657874ae20352e352e31332e3420a9323030302d323032342069546578742047726f7570204e56205c284147504c2d76657273696f6e5c29292f4372656174696f6e4461746528443a32303235303832333131313731332b303527333027292f4d6f644461746528443a32303235303832333131313731332b303527333027293e3e0a656e646f626a0a787265660a3020370a303030303030303030302036353533352066200a30303030303030333733203030303030206e200a30303030303030303135203030303030206e200a30303030303030343631203030303030206e200a30303030303030323631203030303030206e200a30303030303030353132203030303030206e200a30303030303030353537203030303030206e200a747261696c65720a3c3c2f53697a6520372f526f6f742035203020522f496e666f2036203020522f4944205b3c66663733633761613130653664623434306537316132376530626637633864303e3c66663733633761613130653664623434306537316132376530626637633864303e5d3e3e0a2569546578742d352e352e31332e340a7374617274787265660a3731370a2525454f460a);

-- --------------------------------------------------------

--
-- Table structure for table `fees`
--

CREATE TABLE `fees` (
  `feeID` int(11) NOT NULL,
  `feeAmount` double NOT NULL,
  `courseID` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `marks`
--

CREATE TABLE `marks` (
  `enrollmentNo` bigint(20) NOT NULL,
  `obtainedMark` double NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `marks`
--

INSERT INTO `marks` (`enrollmentNo`, `obtainedMark`) VALUES
(24002170210035, 25),
(24002170210098, 21),
(24002170210099, 7),
(24002170510015, 24);

-- --------------------------------------------------------

--
-- Table structure for table `notice`
--

CREATE TABLE `notice` (
  `noticeNo` int(11) NOT NULL,
  `discription` varchar(50) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `notificationfaculty`
--

CREATE TABLE `notificationfaculty` (
  `notificationID` int(11) NOT NULL,
  `facultyID` int(11) NOT NULL,
  `notificationContent` varchar(100) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `notificationfaculty`
--

INSERT INTO `notificationfaculty` (`notificationID`, `facultyID`, `notificationContent`) VALUES
(9, 2, 'CVM notification abc');

-- --------------------------------------------------------

--
-- Table structure for table `notificationstudent`
--

CREATE TABLE `notificationstudent` (
  `notificationID` int(11) NOT NULL,
  `enrollmentNo` bigint(20) NOT NULL,
  `notificationContent` varchar(100) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `notificationstudent`
--

INSERT INTO `notificationstudent` (`notificationID`, `enrollmentNo`, `notificationContent`) VALUES
(112, 24002170210035, 'Exam scheduled: Java on 2025-08-13 at 12:30:00'),
(113, 24002170210098, 'Exam scheduled: Java on 2025-08-13 at 12:30:00'),
(114, 24002170510015, 'Exam scheduled: Java on 2025-08-13 at 12:30:00'),
(115, 24002170210035, 'Exam scheduled: Maths on 2025-08-23 at 11:30:00'),
(116, 24002170210098, 'Exam scheduled: Maths on 2025-08-23 at 11:30:00'),
(117, 24002170510015, 'Exam scheduled: Maths on 2025-08-23 at 11:30:00'),
(118, 24002170210035, 'Exam scheduled: Java on 2025-11-23 at 12:12:00'),
(119, 24002170210098, 'Exam scheduled: Java on 2025-11-23 at 12:12:00'),
(120, 24002170210099, 'Exam scheduled: Java on 2025-11-23 at 12:12:00'),
(121, 24002170510015, 'Exam scheduled: Java on 2025-11-23 at 12:12:00');

-- --------------------------------------------------------

--
-- Table structure for table `operation_log`
--

CREATE TABLE `operation_log` (
  `log_id` int(11) NOT NULL,
  `table_name` varchar(50) DEFAULT NULL,
  `operation_type` varchar(50) DEFAULT NULL,
  `affected_row_id` varchar(50) DEFAULT NULL,
  `operation_time` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `operation_log`
--

INSERT INTO `operation_log` (`log_id`, `table_name`, `operation_type`, `affected_row_id`, `operation_time`) VALUES
(161, 'student', 'delete', '24002170210098', '2025-08-23 05:13:43'),
(162, 'student', 'INSERT', '24002170210098', '2025-08-23 05:37:07'),
(163, 'student', 'INSERT', '24002170210035', '2025-08-23 05:38:47'),
(164, 'student', 'INSERT', '24002170510015', '2025-08-23 05:40:24'),
(165, 'faculty', 'INSERT', '1', '2025-08-23 05:43:37'),
(166, 'faculty', 'INSERT', '2', '2025-08-23 05:44:36'),
(167, 'faculty', 'INSERT', '3', '2025-08-23 05:47:13'),
(168, 'faculty', 'UPDATE', '2', '2025-08-23 05:48:19'),
(169, 'faculty', 'UPDATE', '1', '2025-08-23 05:48:52'),
(170, 'faculty', 'UPDATE', '2', '2025-08-23 05:49:17'),
(171, 'faculty', 'UPDATE', '3', '2025-08-23 05:49:34'),
(172, 'student', 'INSERT', '24002170210099', '2025-08-23 06:05:47');

-- --------------------------------------------------------

--
-- Table structure for table `student`
--

CREATE TABLE `student` (
  `enrollmentNo` bigint(20) NOT NULL,
  `studentName` varchar(50) NOT NULL,
  `studentPassword` varchar(50) NOT NULL,
  `studentContactNo` varchar(50) NOT NULL,
  `studentEmail` varchar(50) NOT NULL,
  `studentAddress` varchar(50) NOT NULL,
  `deptID` int(11) NOT NULL,
  `courseID` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `student`
--

INSERT INTO `student` (`enrollmentNo`, `studentName`, `studentPassword`, `studentContactNo`, `studentEmail`, `studentAddress`, `deptID`, `courseID`) VALUES
(24002170210035, 'Yashraj', 'yashraj@35', '9878096789', 'yashraj@ljku.edu.in', 'meghpar', 2, 3),
(24002170210098, 'Mihir', 'Mihir@2121', '9712969357', 'mihir@ljku.edu.in', 'botad', 2, 1),
(24002170210099, 'TRY', 'TRY@123', '9824243657', 'abc@ljku.edu.in', 'abc', 2, 3),
(24002170510015, 'Yashvi', 'yashvi@0408', '8998897898', 'yashvi@ljku.edu.in', 'ahemdabad', 2, 3);

--
-- Triggers `student`
--
DELIMITER $$
CREATE TRIGGER `student_after_delete` AFTER DELETE ON `student` FOR EACH ROW BEGIN
CALL log_operation('student','delete',old.enrollmentNo);
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `student_after_insert` AFTER INSERT ON `student` FOR EACH ROW BEGIN
    CALL log_operation('student', 'INSERT', NEW.enrollmentNo);
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `student_after_update` AFTER UPDATE ON `student` FOR EACH ROW BEGIN
	CALL log_operation 								('student','update',old.enrollmentNo);
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `trg_student_delete_backup` AFTER DELETE ON `student` FOR EACH ROW BEGIN
  INSERT INTO student_backup (
    enrollmentNo, studentName, studentPassword, studentContactNo,
    studentEmail, studentAddress, deptID, courseID
  ) VALUES (
    OLD.enrollmentNo, OLD.studentName, OLD.studentPassword, OLD.studentContactNo,
    OLD.studentEmail, OLD.studentAddress, OLD.deptID, OLD.courseID
  );
END
$$
DELIMITER ;
DELIMITER $$
CREATE TRIGGER `validate_student_data` BEFORE INSERT ON `student` FOR EACH ROW BEGIN
    -- Check enrollment number (must be exactly 14 digits, numeric LONG)
    IF CHAR_LENGTH(CAST(NEW.enrollmentNo AS CHAR)) <> 14 THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Enter valid Enrollment number (must be exactly 14 digits)';
    END IF;

    -- Check name is not null or empty
    IF NEW.studentName IS NULL OR TRIM(NEW.studentName) = '' THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Name cannot be NULL or empty';
    END IF;
    
     -- Check password contains at least one special character, one number, and one alphabet
   IF NEW.studentPassword NOT REGEXP '^(?=.*[A-Za-z])(?=.*[0-9])(?=.*[^A-Za-z0-9]).+$' THEN
    SIGNAL SQLSTATE '45000'
    SET MESSAGE_TEXT = 'Password must contain at least one alphabet, one number, and one special character';
END IF;


    -- Check mobile number (must start with 9, 8, or 7 and have 10 digits)
    IF NEW.studentContactNo NOT REGEXP '^[987][0-9]{9}$' THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Mobile number must be 10 digits starting with 9, 8, or 7';
    END IF;
    
     -- Check email ends with @ljku.edu.in
    IF NEW.studentEmail NOT LIKE '%@ljku.edu.in' THEN
        SIGNAL SQLSTATE '45000'
        SET MESSAGE_TEXT = 'Email must end with @ljku.edu.in';
    END IF;

   
END
$$
DELIMITER ;

-- --------------------------------------------------------

--
-- Table structure for table `studentfiles`
--

CREATE TABLE `studentfiles` (
  `EnrollmentNo` bigint(20) NOT NULL,
  `FileName` varchar(30) NOT NULL,
  `File` longblob NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `studentfiles`
--

INSERT INTO `studentfiles` (`EnrollmentNo`, `FileName`, `File`) VALUES
(24002170210098, '24002170210098.pdf', 0x255044462d312e340a25e2e3cfd30a322030206f626a0a3c3c2f4c656e677468203139392f46696c7465722f466c6174654465636f64653e3e73747265616d0a789c75cf4b0ec2201006e03da798a52e5a01b50f563eaa890b8d462e8082b1b52d0a345e5f6a5c68828b4926996f26ff3cd082a37102194e804b84212259df8cd60408057e4183a3eba46a1d14ca89b2b6435e79867ff460d51a5dd78d673bcd804e30a624f585719e051776a2510cb6e5b534c1f95e58fbd4467ecc8c124a8270a95b27ce8e419e129a27f9789a8613363e3c83e67dadae6e5dac6417976d10cfa534ca5a0627ed840c9242dd8571fdc7d1a6f02fff09d719abdee03bfd8aa3037a018176610f0a656e6473747265616d0a656e646f626a0a342030206f626a0a3c3c2f547970652f506167652f4d65646961426f785b30203020353935203834325d2f5265736f75726365733c3c2f466f6e743c3c2f46312031203020523e3e3e3e2f436f6e74656e74732032203020522f506172656e742033203020523e3e0a656e646f626a0a312030206f626a0a3c3c2f547970652f466f6e742f537562747970652f54797065312f42617365466f6e742f48656c7665746963612f456e636f64696e672f57696e416e7369456e636f64696e673e3e0a656e646f626a0a332030206f626a0a3c3c2f547970652f50616765732f436f756e7420312f4b6964735b34203020525d3e3e0a656e646f626a0a352030206f626a0a3c3c2f547970652f436174616c6f672f50616765732033203020523e3e0a656e646f626a0a362030206f626a0a3c3c2f50726f6475636572286954657874ae20352e352e31332e3420a9323030302d323032342069546578742047726f7570204e56205c284147504c2d76657273696f6e5c29292f4372656174696f6e4461746528443a32303235303832333131303730382b303527333027292f4d6f644461746528443a32303235303832333131303730382b303527333027293e3e0a656e646f626a0a787265660a3020370a303030303030303030302036353533352066200a30303030303030333933203030303030206e200a30303030303030303135203030303030206e200a30303030303030343831203030303030206e200a30303030303030323831203030303030206e200a30303030303030353332203030303030206e200a30303030303030353737203030303030206e200a747261696c65720a3c3c2f53697a6520372f526f6f742035203020522f496e666f2036203020522f4944205b3c38313838383661373031386265383162643635363035633530616235613138643e3c38313838383661373031386265383162643635363035633530616235613138643e5d3e3e0a2569546578742d352e352e31332e340a7374617274787265660a3733370a2525454f460a),
(24002170210035, '24002170210035.pdf', 0x255044462d312e340a25e2e3cfd30a322030206f626a0a3c3c2f4c656e677468203230312f46696c7465722f466c6174654465636f64653e3e73747265616d0a789c75cf3d0f82301006e0bdbfe2461dc4020aa5931f68e2423476716c6c15900f6d4b8cffdeaa839a94e1924beeb9cb7b37b460288c80e008984018463e7935e3b50f7e00ec84067bd309d91848a5e145a587acb40cffe9c1aa516d55d596652d85608271e0c7b6300ea7ce858cd792c281eb5cf1d229b65ceb7bab0485c747cd7a4e2ddbc6f0a3a1909098e0248a49e2ce58dbf8df6b5579e93c293aaf689c7c2e84925a53a8e539bf72e544a9b413f3fa7bb449ede33d013ba5e51b843f60c5d00e3d01ef6e643c0a656e6473747265616d0a656e646f626a0a342030206f626a0a3c3c2f547970652f506167652f4d65646961426f785b30203020353935203834325d2f5265736f75726365733c3c2f466f6e743c3c2f46312031203020523e3e3e3e2f436f6e74656e74732032203020522f506172656e742033203020523e3e0a656e646f626a0a312030206f626a0a3c3c2f547970652f466f6e742f537562747970652f54797065312f42617365466f6e742f48656c7665746963612f456e636f64696e672f57696e416e7369456e636f64696e673e3e0a656e646f626a0a332030206f626a0a3c3c2f547970652f50616765732f436f756e7420312f4b6964735b34203020525d3e3e0a656e646f626a0a352030206f626a0a3c3c2f547970652f436174616c6f672f50616765732033203020523e3e0a656e646f626a0a362030206f626a0a3c3c2f50726f6475636572286954657874ae20352e352e31332e3420a9323030302d323032342069546578742047726f7570204e56205c284147504c2d76657273696f6e5c29292f4372656174696f6e4461746528443a32303235303832333131303834372b303527333027292f4d6f644461746528443a32303235303832333131303834372b303527333027293e3e0a656e646f626a0a787265660a3020370a303030303030303030302036353533352066200a30303030303030333935203030303030206e200a30303030303030303135203030303030206e200a30303030303030343833203030303030206e200a30303030303030323833203030303030206e200a30303030303030353334203030303030206e200a30303030303030353739203030303030206e200a747261696c65720a3c3c2f53697a6520372f526f6f742035203020522f496e666f2036203020522f4944205b3c61663632326461326666656166346433646561326438323338626664646532613e3c61663632326461326666656166346433646561326438323338626664646532613e5d3e3e0a2569546578742d352e352e31332e340a7374617274787265660a3733390a2525454f460a),
(24002170510015, '24002170510015.pdf', 0x255044462d312e340a25e2e3cfd30a322030206f626a0a3c3c2f4c656e677468203230352f46696c7465722f466c6174654465636f64653e3e73747265616d0a789c75cfbb6e02311005d0de5f312514c0781fe07505643712cd2a286e524e622316f691d85ea2fc7d0c050a92d34d71e6eade2fb6552c5d82c02528cd10665c5c8fc533079e803ab0c9ab1fb5e93d94c653d3baa93a05860f7a52f57668db2eb07a90906488095f61ce11791e7da8a93312dec81d2f4d14bc9073df83d5127e6e688d198aa87c1a7a4f1f5e82280a218a9528e2aeea42fd7b5c7b3a8f73a3c779d347f5466b6b9c934047d3697a271d65a5f924ebafc367bb322cffa7e1689db981f40fa814dbb35f0f0064360a656e6473747265616d0a656e646f626a0a342030206f626a0a3c3c2f547970652f506167652f4d65646961426f785b30203020353935203834325d2f5265736f75726365733c3c2f466f6e743c3c2f46312031203020523e3e3e3e2f436f6e74656e74732032203020522f506172656e742033203020523e3e0a656e646f626a0a312030206f626a0a3c3c2f547970652f466f6e742f537562747970652f54797065312f42617365466f6e742f48656c7665746963612f456e636f64696e672f57696e416e7369456e636f64696e673e3e0a656e646f626a0a332030206f626a0a3c3c2f547970652f50616765732f436f756e7420312f4b6964735b34203020525d3e3e0a656e646f626a0a352030206f626a0a3c3c2f547970652f436174616c6f672f50616765732033203020523e3e0a656e646f626a0a362030206f626a0a3c3c2f50726f6475636572286954657874ae20352e352e31332e3420a9323030302d323032342069546578742047726f7570204e56205c284147504c2d76657273696f6e5c29292f4372656174696f6e4461746528443a32303235303832333131313032342b303527333027292f4d6f644461746528443a32303235303832333131313032342b303527333027293e3e0a656e646f626a0a787265660a3020370a303030303030303030302036353533352066200a30303030303030333939203030303030206e200a30303030303030303135203030303030206e200a30303030303030343837203030303030206e200a30303030303030323837203030303030206e200a30303030303030353338203030303030206e200a30303030303030353833203030303030206e200a747261696c65720a3c3c2f53697a6520372f526f6f742035203020522f496e666f2036203020522f4944205b3c34343163316461623836346530336133366634303931376665396436663635313e3c34343163316461623836346530336133366634303931376665396436663635313e5d3e3e0a2569546578742d352e352e31332e340a7374617274787265660a3734330a2525454f460a),
(24002170210099, '24002170210099.pdf', 0x255044462d312e340a25e2e3cfd30a322030206f626a0a3c3c2f4c656e677468203139332f46696c7465722f466c6174654465636f64653e3e73747265616d0a789c75cfbb0e82301406e0bd4f71461cc4b62002132a9ab8102f5d1c2bad89ca457b89af6f61d2a40e2739c9f94ef2ff2fb462284a20c5093081304c493a2cb32d0142815d51703256c8ce40290dbf357ac2ee8ee11f1d6c3ad5374deb58d5e740638c2959b8c138cbbc0f156f650eec78f65ef75ceb77afc4280a4223af5af79de1b5c9214b694ce328992ffce15a973b077ea98be6feb0a11436bc755eba144249ad47ec05a57c726586a2d35de99afe0966959623f84ebe61e8803e01d25d0f0a656e6473747265616d0a656e646f626a0a342030206f626a0a3c3c2f547970652f506167652f4d65646961426f785b30203020353935203834325d2f5265736f75726365733c3c2f466f6e743c3c2f46312031203020523e3e3e3e2f436f6e74656e74732032203020522f506172656e742033203020523e3e0a656e646f626a0a312030206f626a0a3c3c2f547970652f466f6e742f537562747970652f54797065312f42617365466f6e742f48656c7665746963612f456e636f64696e672f57696e416e7369456e636f64696e673e3e0a656e646f626a0a332030206f626a0a3c3c2f547970652f50616765732f436f756e7420312f4b6964735b34203020525d3e3e0a656e646f626a0a352030206f626a0a3c3c2f547970652f436174616c6f672f50616765732033203020523e3e0a656e646f626a0a362030206f626a0a3c3c2f50726f6475636572286954657874ae20352e352e31332e3420a9323030302d323032342069546578742047726f7570204e56205c284147504c2d76657273696f6e5c29292f4372656174696f6e4461746528443a32303235303832333131333534372b303527333027292f4d6f644461746528443a32303235303832333131333534372b303527333027293e3e0a656e646f626a0a787265660a3020370a303030303030303030302036353533352066200a30303030303030333837203030303030206e200a30303030303030303135203030303030206e200a30303030303030343735203030303030206e200a30303030303030323735203030303030206e200a30303030303030353236203030303030206e200a30303030303030353731203030303030206e200a747261696c65720a3c3c2f53697a6520372f526f6f742035203020522f496e666f2036203020522f4944205b3c32333635343837386364323664353236633632393766373865643036643834373e3c32333635343837386364323664353236633632393766373865643036643834373e5d3e3e0a2569546578742d352e352e31332e340a7374617274787265660a3733310a2525454f460a);

-- --------------------------------------------------------

--
-- Table structure for table `student_backup`
--

CREATE TABLE `student_backup` (
  `enrollmentNo` bigint(20) NOT NULL,
  `studentName` varchar(255) NOT NULL,
  `studentPassword` varchar(255) NOT NULL,
  `studentContactNo` varchar(50) DEFAULT NULL,
  `studentEmail` varchar(255) DEFAULT NULL,
  `studentAddress` varchar(500) DEFAULT NULL,
  `deptID` int(11) DEFAULT NULL,
  `courseID` int(11) DEFAULT NULL,
  `deleted_at` timestamp NOT NULL DEFAULT current_timestamp()
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

-- --------------------------------------------------------

--
-- Table structure for table `subject`
--

CREATE TABLE `subject` (
  `subjectID` int(11) NOT NULL,
  `subjectName` varchar(50) NOT NULL,
  `credit` int(11) NOT NULL,
  `courseID` int(11) NOT NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;

--
-- Dumping data for table `subject`
--

INSERT INTO `subject` (`subjectID`, `subjectName`, `credit`, `courseID`) VALUES
(1, 'Java', 5, 1),
(2, 'Maths', 5, 2),
(3, 'DBMS', 5, 3);

--
-- Indexes for dumped tables
--

--
-- Indexes for table `attendance`
--
ALTER TABLE `attendance`
  ADD PRIMARY KEY (`enrollmentNo`,`date`);

--
-- Indexes for table `course`
--
ALTER TABLE `course`
  ADD PRIMARY KEY (`courseID`);

--
-- Indexes for table `department`
--
ALTER TABLE `department`
  ADD PRIMARY KEY (`deptID`);

--
-- Indexes for table `event`
--
ALTER TABLE `event`
  ADD PRIMARY KEY (`eventNo`);

--
-- Indexes for table `faculty`
--
ALTER TABLE `faculty`
  ADD PRIMARY KEY (`facultyID`);

--
-- Indexes for table `fees`
--
ALTER TABLE `fees`
  ADD PRIMARY KEY (`feeID`);

--
-- Indexes for table `marks`
--
ALTER TABLE `marks`
  ADD PRIMARY KEY (`enrollmentNo`);

--
-- Indexes for table `notice`
--
ALTER TABLE `notice`
  ADD PRIMARY KEY (`noticeNo`);

--
-- Indexes for table `notificationfaculty`
--
ALTER TABLE `notificationfaculty`
  ADD PRIMARY KEY (`notificationID`);

--
-- Indexes for table `notificationstudent`
--
ALTER TABLE `notificationstudent`
  ADD PRIMARY KEY (`notificationID`);

--
-- Indexes for table `operation_log`
--
ALTER TABLE `operation_log`
  ADD PRIMARY KEY (`log_id`);

--
-- Indexes for table `student`
--
ALTER TABLE `student`
  ADD PRIMARY KEY (`enrollmentNo`);

--
-- Indexes for table `subject`
--
ALTER TABLE `subject`
  ADD PRIMARY KEY (`subjectID`);

--
-- AUTO_INCREMENT for dumped tables
--

--
-- AUTO_INCREMENT for table `event`
--
ALTER TABLE `event`
  MODIFY `eventNo` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=30;

--
-- AUTO_INCREMENT for table `notificationfaculty`
--
ALTER TABLE `notificationfaculty`
  MODIFY `notificationID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=10;

--
-- AUTO_INCREMENT for table `notificationstudent`
--
ALTER TABLE `notificationstudent`
  MODIFY `notificationID` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=125;

--
-- AUTO_INCREMENT for table `operation_log`
--
ALTER TABLE `operation_log`
  MODIFY `log_id` int(11) NOT NULL AUTO_INCREMENT, AUTO_INCREMENT=173;
COMMIT;

/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */;
/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */;
